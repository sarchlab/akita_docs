---
title: Introducing TLB in Akita
description: We have updated the operations of TLB with new protocols and middlewares
slug: tlb-in-akita
authors: [daoxuanxu, huizhizhao]
tags: [akita, tlb]
hide_table_of_contents: false
---

# TLB in Akita

The Translation Lookaside Buffer (TLB) is a crucial component in virtual memory systems that speeds up virtual-to-physical address translation. 

We have updated the `tlb` package with our “drain-flush-restart” protocol and implemented middlewares to the support higher modularity, flexibility, and efficiency.

<!-- truncate -->

## Problems
Control messages and operational requests are not diversified. TLB functionalities are concentrated and lengthy.

## Key Components and Features

`tlbMiddleware` is responsible for managing and executing all internal TLB requests and tasks. It is designed to operate in a pipelined manner, processing up to multiple requests per cycle and maintaining internal state for control flow. The basic flow of the tlbMiddleware is as follows:
- As tlbMiddleware performs `Tick()`,
    - Peeks into the controlPort and perform the control message to either perform `Flush`/`Restart` or switch the tlbMiddleware state between `enable`/`drain`/`pause`;
    - According to current state, executes state-dependent behavior: enabled, draining, or paused
        - In the `enabled` state, the middleware tries to:
            * Send responded MSHR entries to top (respondMSHREntry)
            * Parse incoming translation responses from lower memory (parseBottom)
            * Ticks pipeline to retrieve rew translation requests and process (lookup)
        - In the `draining` state, the middleware tries to:
            * Respond to completed MSHR entries (respondMSHREntry)
            * Parse incoming translation responses from lower memory (parseBottom)
            * Ticks pipeline to process remaining requests (lookup)
            * Switch state to “pause” if both MSHR and bottomPort are drained to empty
        - In the `paused` state, the middleware does nothing.